# H2æ•°æ®åº“ä½¿ç”¨è¯´æ˜

## ä»€ä¹ˆæ˜¯H2æ•°æ®åº“ï¼Ÿ

H2æ˜¯ä¸€ä¸ª**è½»é‡çº§çš„Javaæ•°æ®åº“**ï¼Œéå¸¸é€‚åˆå­¦ä¹ å’Œå¼€å‘ï¼š

- âœ… çº¯Javaç¼–å†™ï¼Œæ— éœ€å®‰è£…
- âœ… æ”¯æŒå†…å­˜æ¨¡å¼å’Œæ–‡ä»¶æ¨¡å¼
- âœ… å…¼å®¹SQLæ ‡å‡†
- âœ… è‡ªå¸¦Webæ§åˆ¶å°
- âœ… Spring Booté»˜è®¤æ”¯æŒ

## å†…å­˜æ¨¡å¼ vs æ–‡ä»¶æ¨¡å¼

### å†…å­˜æ¨¡å¼ï¼ˆå­¦ä¹ æ¨èï¼‰

```java
// URLæ ¼å¼
jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1

// ç‰¹ç‚¹
- æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­
- é€Ÿåº¦æå¿«
- JVMå…³é—­åæ•°æ®æ¶ˆå¤±
- é€‚åˆæµ‹è¯•å’Œå­¦ä¹ 
```

**é‡è¦å‚æ•°**ï¼š
- `DB_CLOSE_DELAY=-1`ï¼šä¿æŒæ•°æ®åº“ç›´åˆ°JVMå…³é—­
- ä¸åŠ è¿™ä¸ªå‚æ•°ï¼šæ¯æ¬¡è¿æ¥å…³é—­åæ•°æ®åº“è¢«æ¸…ç©º

### æ–‡ä»¶æ¨¡å¼ï¼ˆæŒä¹…åŒ–ï¼‰

```java
// URLæ ¼å¼
jdbc:h2:file:./data/mydb

// ç‰¹ç‚¹
- æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ä¸­
- é‡å¯åæ•°æ®ä¿ç•™
- é€‚åˆå¼€å‘ç¯å¢ƒ
```

## åœ¨JdbcDemoä¸­çš„åº”ç”¨

```java
// æ­£ç¡®é…ç½®
private static final String URL = "jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1";
private static final String USER = "sa";
private static final String PASSWORD = "";
```

**ä¸ºä»€ä¹ˆéœ€è¦`DB_CLOSE_DELAY=-1`ï¼Ÿ**

```java
// å¦‚æœä¸åŠ è¿™ä¸ªå‚æ•°
try (Connection conn1 = getConnection()) {
    // åˆ›å»ºè¡¨
    stmt.execute("CREATE TABLE users (...)");
} // conn1å…³é—­ï¼Œæ•°æ®åº“è¢«æ¸…ç©ºï¼

try (Connection conn2 = getConnection()) {
    // âŒ è¡¨ä¸å­˜åœ¨äº†ï¼
    stmt.execute("INSERT INTO users ...");
}
```

```java
// åŠ ä¸Šå‚æ•°å
// URL = "jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1"

try (Connection conn1 = getConnection()) {
    stmt.execute("CREATE TABLE users (...)");
} // conn1å…³é—­ï¼Œä½†æ•°æ®åº“ä¿ç•™

try (Connection conn2 = getConnection()) {
    // âœ“ è¡¨è¿˜åœ¨ï¼
    stmt.execute("INSERT INTO users ...");
}
```

## H2æ§åˆ¶å°ï¼ˆå¯é€‰ï¼‰

H2æä¾›äº†ä¸€ä¸ªWebæ§åˆ¶å°æ¥æŸ¥çœ‹æ•°æ®ï¼š

### å¯åŠ¨æ§åˆ¶å°

```java
// åœ¨ä»£ç ä¸­å¯åŠ¨ï¼ˆä»…ç”¨äºå¼€å‘è°ƒè¯•ï¼‰
import org.h2.tools.Server;

Server server = Server.createWebServer("-web", "-webAllowOthers").start();
System.out.println("H2æ§åˆ¶å°: http://localhost:8082");
```

### è®¿é—®æ§åˆ¶å°

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8082
2. è¾“å…¥è¿æ¥ä¿¡æ¯ï¼š
   - JDBC URL: `jdbc:h2:mem:testdb`
   - ç”¨æˆ·å: `sa`
   - å¯†ç : (ç•™ç©º)
3. ç‚¹å‡»"è¿æ¥"å³å¯æŸ¥çœ‹æ•°æ®åº“

## Spring Bootä¸­çš„H2

Spring Booté¡¹ç›®ä¸­ä½¿ç”¨H2æ›´ç®€å•ï¼š

### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

### 2. é…ç½®application.properties

```properties
# ä½¿ç”¨H2å†…å­˜æ•°æ®åº“
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# å¯ç”¨H2æ§åˆ¶å°
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# æ˜¾ç¤ºSQLè¯­å¥
spring.jpa.show-sql=true
```

### 3. è®¿é—®æ§åˆ¶å°

å¯åŠ¨åº”ç”¨åè®¿é—®ï¼šhttp://localhost:8080/h2-console

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæˆ‘çš„æ•°æ®æ¶ˆå¤±äº†ï¼Ÿ

**A**: æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰`DB_CLOSE_DELAY=-1`å‚æ•°ã€‚

### Q2: èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒå—ï¼Ÿ

**A**: âŒ ä¸å»ºè®®ã€‚H2é€‚åˆå¼€å‘å’Œæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨MySQLã€PostgreSQLç­‰ã€‚

### Q3: å¦‚ä½•æŒä¹…åŒ–æ•°æ®ï¼Ÿ

**A**: ä½¿ç”¨æ–‡ä»¶æ¨¡å¼ï¼š`jdbc:h2:file:./data/mydb`

### Q4: Spring Bootæµ‹è¯•æ—¶å¦‚ä½•ä½¿ç”¨ï¼Ÿ

**A**: Spring Bootä¼šè‡ªåŠ¨é…ç½®H2ç”¨äº@DataJpaTestç­‰æµ‹è¯•ã€‚

```java
@DataJpaTest  // è‡ªåŠ¨ä½¿ç”¨H2å†…å­˜æ•°æ®åº“
public class UserRepositoryTest {
    @Autowired
    private UserRepository repository;

    @Test
    void testSave() {
        User user = new User("å¼ ä¸‰", "test@example.com");
        repository.save(user);
        assertNotNull(user.getId());
    }
}
```

## å­¦ä¹ å»ºè®®

1. **JdbcDemoé˜¶æ®µ**ï¼šä½¿ç”¨`jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1`
2. **Spring Data JPAé˜¶æ®µ**ï¼šè®©Spring Bootè‡ªåŠ¨é…ç½®
3. **å®é™…é¡¹ç›®**ï¼šåˆ‡æ¢åˆ°MySQL/PostgreSQL

## ç›¸å…³æ–‡ä»¶

- [JdbcDemo.java](src/advanced/JdbcDemo.java) - JDBCåŸºç¡€æ“ä½œç¤ºä¾‹
- [pom.xml](pom.xml) - H2ä¾èµ–é…ç½®

---

**è®°ä½**ï¼šH2æ˜¯å­¦ä¹ åˆ©å™¨ï¼Œå¼€å‘ç¥å™¨ï¼Œä½†ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ä¸“ä¸šæ•°æ®åº“ï¼ğŸ¯
